package com.sherman.smartplugex.ui.util;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.InterruptedIOException;
import java.io.OutputStream;
import java.net.DatagramPacket;
import java.net.DatagramSocket;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.SocketTimeoutException;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.util.EntityUtils;

import com.alibaba.fastjson.JSONArray;
import com.alibaba.fastjson.JSONObject;
import com.sherman.smartlock.ui.common.PubDefine;

import android.annotation.SuppressLint;
import android.content.Context;
import android.os.AsyncTask;
import android.os.Handler;
import android.os.Message;
import android.speech.tts.TextToSpeech;
import android.util.Log;

public class PubFunc {
	private static PubFunc mInstance = null;
	
	public final static int  MSG_NOTIFY_INIT					= 0;
	public final static int  MSG_NOTIFY_SUCCESS					= 1;
	public final static int  MSG_NOTIFY_FAIL					= 2;
	public final static int  MSG_NOTIFY_NETWORK_FAIL			= 3;
	public final static int  MSG_UPDATE_LISTVIEW_SCANPORT		= 4;
	public final static int  MSG_UPDATE_LISTVIEW_SCANPORT_END	= 5;
	public final static int  MSG_UPDATE_SCANBTN_ENABLE			= 6;
	public final static int  MSG_UPDATE_SCANBTN_DISABLE			= 7;
	public final static int  MSG_UPDATE_SHOW_INFO				= 8;
	public final static int  MSG_SHOW_MESSAGE 					= 9;
	public final static int  MSG_UPDATE_TJDATA 					= 10;
	public final static int  MSG_UPDATE_TJDATA_BAK 				= 11;
	private final static int MSG_READ_CITY_WEATHER				= 12;
	
	// UDP Scan Port Mode
	public static final int UDP_MAX_RETRIES_SEND		= 1; 	    				// Êú?Â§ßÈáçÂèëÊ¨°Êï?5Ê¨?
	public static final int UDP_MAX_RETRIES_RECV		= 3; 	    				// Êú?Â§ßÊé•Êî∂Ê¨°Êï?5Ê¨?
	
	public final static int UDP_MAX_RECEIVE_IP_NUM  	= 256;						// Êú?Â§ßÊé•Êî∂Êï∞ÊçÆÁöÑÊ¨°Êï∞
	public final static int UDP_RECEIVE_BUFFER_SIZE 	= 1024;						// Êé•Êî∂Êï∞ÊçÆÁöÑÁºìÂÜ≤Âô®Â§ßÂ∞è
	public final static int UDP_TIME_OUT				= 5000;						// UDP ÁΩëÁªúËÆøÈóÆË∂ÖÊó∂Êó∂Èó¥ ÈªòËÆ§Ôº?5Áß?
	public final static int UDP_SRC_PORT 				= 50022;						// Êú¨Âú∞UDPÁ´ØÂè£Âè?
	public final static int UDP_DEST_PORT 				= 5000;						// Êâ´ÊèèUDPÁ´ØÂè£Âè∑ÔºöÂç≥ÔºöÊô∫ËÉΩÊèíÂ∫ßÁöÑUDPÁ´ØÂè£Âè? 
	
	public final static String UDP_SCANPORT_COMMAND		= "0,REPORTIP,test,null#";	// Êâ´ÊèèUDPÁ´ØÂè£Âè∑Áî®ÁöÑÂëΩ‰ª§Ë°åËØ≠Âè•
	
	// TCP Scan Port Mode
	public final static int TCP_TIME_OUT				= 5000;
	public final static int TCP_PORT_ID					= 6002;
	
	// Thread Sleep Time for ListView Show Data
	public final static int THREAD_SLEEP_TIME			= 500;
	
	public static PubFunc getInstance() {
		if (null == mInstance) {
			mInstance = new PubFunc();
		}
		return mInstance;
	}
	
		// Ê†πÊçÆ ‰∏çÂêåÁöÑËØ≠Èü≥ÂÜÖÂÆ? ÂèëÈ?Å‰∏çÂêåÁöÑÂëΩ‰ª§
		@SuppressLint("NewApi") 
		public void parseCommand(String text, String moduleID, Handler mHandler, boolean b_speech, TextToSpeech tSpeech) {
//			showTip(mHandler, "ÂëΩ‰ª§Ôº?" + text);
			
			String cmd_text = "";			
			Map<String, Object> m_mapCmd = null;
			m_mapCmd = new HashMap<String, Object>();
			
			// Êëá‰∏ÄÊëáÁÅØÁöÑÂëΩ‰ª?
			String[] key_light_on 	= {"Âº?", "ÁÅ?"};
			String[] key_light_off 	= {"ÂÖ?", "ÁÅ?"};
			String[] key_power_on 	= {"Âº?", "Áî?"};
			String[] key_power_off 	= {"ÂÖ?", "Áî?"};
			String[] key_usb_on 	= {"Âº?", "USB"};
			String[] key_usb_off 	= {"ÂÖ?", "USB"};
			String[] key_rgb_red 	= {"Á∫?"};
			String[] key_rgb_green 	= {"Áª?"};
			String[] key_rgb_blue 	= {"Ëì?"};
			String[] key_rgb_purple	= {"Á¥?"};
			String[] key_rgb_white	= {"Áô?"};
			String[] key_rgb_black	= {"Èª?"};
			String[] key_rgb_blue_flash	= {"Èó™ÁÉÅ"};
			// Â∞èËΩ¶Âπ≥Âè∞ÁöÑÂëΩ‰ª?
			String[] key_action_forward		= {"ÂêëÂâç"};
			String[] key_action_backward	= {"ÂêëÂêé"};
			String[] key_action_left		= {"Â∑¶ËΩ¨"};
			String[] key_action_left2		= {"Â∑¶‰º†"};
			String[] key_action_right		= {"Âè≥ËΩ¨"};
			String[] key_action_speedup		= {"Â¢ûÂä†ÈÄüÂ∫¶"};
			String[] key_action_speeddown	= {"Èôç‰ΩéÈÄüÂ∫¶"};
			String[] key_action_stop		= {"ÂÅúÊ≠¢"};
			// Á∫¢Â§ñÈÅ•ÊéßÁöÑÂëΩ‰ª?--Á©∫Ë∞É
			String[] key_action_ir_air_poweron				= {"ÊâìÂºÄÁ©∫Ë∞É"};
			String[] key_action_ir_air_poweroff				= {"ÂÖ≥Èó≠Á©∫Ë∞É"};
			String[] key_action_ir_air_adjust_temp_18		= {"Á©∫Ë∞ÉË∞ÉÊàê18"};
			String[] key_action_ir_air_adjust_temp_19		= {"Á©∫Ë∞ÉË∞ÉÊàê19"};
			String[] key_action_ir_air_adjust_temp_20		= {"Á©∫Ë∞ÉË∞ÉÊàê20"};
			String[] key_action_ir_air_adjust_temp_21		= {"Á©∫Ë∞ÉË∞ÉÊàê21"};
			String[] key_action_ir_air_adjust_temp_22		= {"Á©∫Ë∞ÉË∞ÉÊàê22"};
			String[] key_action_ir_air_adjust_temp_23		= {"Á©∫Ë∞ÉË∞ÉÊàê23"};
			String[] key_action_ir_air_adjust_temp_24		= {"Á©∫Ë∞ÉË∞ÉÊàê24"};
			String[] key_action_ir_air_adjust_temp_25		= {"Á©∫Ë∞ÉË∞ÉÊàê25"};
			String[] key_action_ir_air_adjust_temp_26		= {"Á©∫Ë∞ÉË∞ÉÊàê26"};
			String[] key_action_ir_air_adjust_temp_27		= {"Á©∫Ë∞ÉË∞ÉÊàê27"};
			String[] key_action_ir_air_adjust_temp_28		= {"Á©∫Ë∞ÉË∞ÉÊàê28"};
			String[] key_action_ir_air_adjust_temp_29		= {"Á©∫Ë∞ÉË∞ÉÊàê29"};
			String[] key_action_ir_air_adjust_temp_30		= {"Á©∫Ë∞ÉË∞ÉÊàê30"};
			
			// Êô∫ËÉΩÁ™óÂ∏ò
			String[] key_action_curtain_open		= {"ÊâìÂºÄÁ™óÂ∏ò"};
			String[] key_action_curtain_close		= {"ÂÖ≥Èó≠Á™óÂ∏ò"};
			String[] key_action_curtain_pause		= {"ÊöÇÂÅúÁ™óÂ∏ò"};
			
			
					
			// Êëá‰∏ÄÊëáÁÅØÁöÑÂëΩ‰ª§Â≠ó
			m_mapCmd.put("20150101121212,POWER,test,12345678,1#", key_power_on);
			m_mapCmd.put("20150101121212,POWER,test,12345678,0#", key_power_off);
			m_mapCmd.put("20150101121212,LIGHT,test,12345678,1#", key_light_on);
			m_mapCmd.put("20150101121212,LIGHT,test,12345678,0#", key_light_off);
			m_mapCmd.put("20150101121212,USB,test,12345678,1#", key_usb_on);
			m_mapCmd.put("20150101121212,USB,test,12345678,0#", key_usb_off);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,255,1,1#", key_rgb_red);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,1,255,1#", key_rgb_green);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,1,1,255#", key_rgb_blue);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,255,1,255#", key_rgb_purple);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,255,255,255#", key_rgb_white);
			m_mapCmd.put("20150101121212,RGB,test,12345678,0,1,1,1#", key_rgb_black);
			m_mapCmd.put("20150101121212,RGB,test,12345678,1,1,1,255#", key_rgb_blue_flash);
			
			// Êô∫ËÉΩÁ™óÂ∏òÁöÑÂëΩ‰ª§Â≠ó
			String cmd = "";
			m_mapCmd.put("20150101121212,APPCURTAIN_ACTION,test,12345678,1#", key_action_curtain_open);
			m_mapCmd.put("20150101121212,APPCURTAIN_ACTION,test,12345678,2#", key_action_curtain_close);
			m_mapCmd.put("20150101121212,APPCURTAIN_ACTION,test,12345678,0#", key_action_curtain_pause);
			
			// Â∞èËΩ¶Âπ≥Âè∞ÁöÑÂëΩ‰ª§Â≠ó
//			0,ACTION,TEST,12345678,MODE=FORWARD/BACKWARD/LEFT/RIGHT/SPEEDUP/SPEEDDOWN/STOP,VALUE1,VALUE2#
			m_mapCmd.put("0,ACTION,test,12345678,FORWARD,100,100#", key_action_forward);
			m_mapCmd.put("0,ACTION,test,12345678,BACKWARD,100,100#", key_action_backward);
			m_mapCmd.put("0,ACTION,test,12345678,LEFT,100,0#", key_action_left);
			m_mapCmd.put("0,ACTION,test,10000002,LEFT,100,0#", key_action_left2);
			m_mapCmd.put("0,ACTION,test,12345678,RIGHT,0,100#", key_action_right);
			m_mapCmd.put("0,ACTION,test,12345678,SPEEDUP,30,30#", key_action_speedup);
			m_mapCmd.put("0,ACTION,test,12345678,SPEEDDOWN,30,30#", key_action_speeddown);
			m_mapCmd.put("0,ACTION,test,12345678,STOP,0,0#", key_action_stop);
			
			// Á∫¢Â§ñÈÅ•ÊéßÁöÑÂëΩ‰ª§Â≠ó--Á©∫Ë∞É
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3000,3000,3050,4200,600,1700,550,550,550,1700,550,700,550,550,550,1700,550,550,550,1850,550,550,600,1650,550,600,550,700,550,550,550,600,550,550,550,1800,550,600,550,550,600,1650,550,700,550,600,550,1650,550,550,600,1800,550,600,500,600,550,550,600,1800,550,1700,550,550,550,1700,550,1800,550,550,550,600,550,550,550,750,550,1650,550,1700,550,600,500,750,500,600,550,1700,550,550,550,700,550,600,550,550,550,600,550,700,550,550,550,1700,550,550,550,750,500,600,550,550,600,550,550,750,500,600,500,600,550,600,500,750,500,600,550,600,500,600,550,750,550,1700,500,600,550,1700,500,1900,500,600,550,600,500,1700,550,600,550,52614#", key_action_ir_air_poweron);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3000,3000,3000,4250,600,1650,550,600,550,1650,550,700,550,600,550,1700,500,600,550,1800,550,600,550,1700,550,550,550,750,500,600,500,600,550,600,500,750,500,600,550,600,550,1650,550,700,550,600,550,1650,550,600,550,1800,550,600,550,550,550,600,550,1800,550,1650,600,550,550,1700,550,1800,550,600,550,550,550,600,500,750,550,1650,550,1700,550,600,550,700,550,550,550,1700,550,550,550,750,500,600,550,600,500,600,550,750,500,550,550,1700,550,600,500,750,550,550,550,600,550,550,550,750,500,600,550,550,550,600,500,750,550,550,550,600,500,600,550,750,550,1650,550,600,550,1700,500,1850,550,600,550,550,550,600,550,1650,600,1836#", key_action_ir_air_poweroff);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3100,3000,3000,4200,650,1650,550,550,550,1650,600,700,550,550,600,1650,550,550,600,1750,600,550,600,550,550,1700,550,700,550,550,550,1700,550,1700,550,1750,600,550,550,550,600,1700,550,650,600,550,550,1700,550,550,550,1800,600,550,550,550,600,550,600,1750,600,1650,550,1700,550,1700,550,650,600,550,550,600,550,550,550,700,600,1650,550,1650,600,550,550,700,550,550,600,1650,550,550,600,650,600,550,600,550,550,550,550,700,600,550,550,1650,600,550,550,700,550,600,550,550,600,550,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,550,600,700,600,1650,550,550,600,550,550,1850,550,1650,550,600,550,1650,600,1650,600,59664#", key_action_ir_air_adjust_temp_18);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3000,4250,600,1650,550,550,600,1650,550,700,550,550,600,1650,600,550,550,1800,550,550,600,550,550,1700,550,1800,550,550,600,1650,550,1700,550,650,600,550,600,550,600,1650,550,700,550,550,600,1650,550,600,550,1800,550,550,550,550,600,550,600,1800,550,1700,550,1650,550,1700,550,700,550,550,550,600,550,550,550,700,600,1650,550,1700,550,550,550,700,550,600,550,1700,550,550,550,700,550,600,550,550,550,600,550,700,550,550,550,1700,550,550,550,700,550,600,550,550,600,550,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,600,550,750,500,1700,550,600,550,1650,550,750,550,1700,550,550,550,1700,550,550,600,27334#", key_action_ir_air_adjust_temp_19);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3000,4250,600,1650,550,550,600,1700,550,650,600,550,550,1650,600,550,550,1800,550,600,550,1700,550,550,550,700,550,600,550,1650,550,1700,550,650,600,600,550,550,600,1650,550,700,550,600,550,1650,550,550,600,1800,550,550,550,600,550,550,600,1750,600,1650,600,1650,550,1700,550,1800,550,600,550,550,550,600,550,700,550,1650,600,1650,550,550,600,650,600,550,550,1650,600,550,550,700,550,550,600,550,550,600,550,700,550,550,550,1700,550,550,600,650,600,550,550,550,600,550,550,700,550,600,550,550,550,600,550,650,600,550,550,600,500,600,550,750,550,1650,550,600,550,1700,550,1800,550,1700,550,550,550,1700,550,1700,550,62036#", key_action_ir_air_adjust_temp_20);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3000,3000,3050,4200,600,1700,550,550,550,1700,550,650,600,550,550,1700,550,550,550,1800,600,550,600,1600,600,600,550,1750,600,550,550,1700,550,1650,600,650,600,550,550,600,550,1650,600,700,550,550,550,1700,550,550,550,1800,550,600,550,550,550,600,550,1800,550,1700,550,1700,550,1650,550,1800,600,550,550,600,550,550,550,700,600,1650,550,1700,550,550,550,700,550,550,600,1650,550,600,550,700,550,550,600,550,550,550,550,700,550,600,550,1700,550,550,550,700,550,550,600,550,600,550,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,550,600,700,550,1700,550,1700,550,550,550,750,550,1650,550,600,550,1650,550,1700,600,8558#", key_action_ir_air_adjust_temp_21);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3050,4200,600,1700,550,550,550,1700,550,700,550,600,500,1700,550,550,600,1750,600,550,600,1650,550,1700,550,700,550,550,550,1700,550,1700,550,650,600,550,550,600,550,1700,550,650,600,550,550,1700,550,550,550,1800,600,550,550,600,550,550,550,1800,600,1650,550,1700,550,1700,550,1800,550,550,550,550,600,550,550,700,600,1650,550,1700,550,550,550,700,550,600,550,1700,550,550,550,700,550,550,600,550,550,600,550,650,600,550,550,1700,550,550,550,700,550,600,550,550,600,550,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,600,550,700,550,1700,550,1700,550,550,550,1850,550,1700,550,550,550,1700,550,1700,550,16552#", key_action_ir_air_adjust_temp_22);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3000,4250,600,1650,550,550,600,1650,550,700,550,600,550,1650,600,550,550,1800,550,600,550,1650,600,1650,550,1800,600,550,550,1650,600,1700,550,700,550,550,550,600,550,1650,550,750,500,600,550,1650,600,550,550,1800,550,600,550,550,550,1700,550,700,550,600,550,550,550,600,550,700,550,550,550,600,550,550,550,700,600,1650,550,1700,550,550,550,700,550,600,550,1650,550,600,550,700,550,550,600,550,550,550,550,700,550,600,550,1700,550,550,550,700,550,600,500,600,550,600,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,550,600,700,550,1700,550,1700,550,1650,550,750,550,1650,550,1700,550,600,550,550,600,27208#", key_action_ir_air_adjust_temp_23);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3000,4250,600,1650,550,550,600,1650,550,700,550,600,550,1650,550,600,550,1800,550,1650,600,550,550,600,550,700,550,600,500,1700,550,1650,600,700,550,550,550,600,550,1700,550,700,550,550,550,1700,550,550,550,1850,550,550,550,600,500,1700,600,650,550,600,550,550,550,600,550,1800,550,600,550,550,550,550,550,750,550,1650,550,1700,550,550,600,700,550,550,550,1700,550,550,550,700,550,600,550,550,550,600,550,700,550,550,550,1700,550,550,550,750,550,550,550,550,600,550,550,700,550,600,550,550,550,600,500,750,550,550,550,550,550,600,550,750,550,1650,550,1700,550,1700,550,1850,500,1700,550,1700,550,550,550,1700,600,16506#", key_action_ir_air_adjust_temp_24);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,2950,3050,4250,600,1650,550,600,550,1650,550,700,550,600,550,1650,550,600,550,1800,550,1650,600,550,600,550,550,1800,550,600,550,1650,600,1650,550,700,550,600,550,550,600,1650,550,700,550,600,550,1650,550,600,550,1800,550,550,550,600,550,1650,600,700,550,550,550,600,550,550,550,1850,500,600,550,550,550,600,550,700,550,1700,550,1650,550,600,550,700,550,600,500,1700,550,600,550,700,550,550,600,550,550,550,550,700,550,600,550,1650,550,600,550,700,550,550,550,600,550,600,500,750,500,600,550,550,550,600,550,700,550,550,550,600,550,550,600,700,550,600,500,600,550,550,550,750,550,1700,500,1700,550,600,550,1650,600,7222#", key_action_ir_air_adjust_temp_25);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3100,2950,3050,4250,600,1600,600,550,550,1700,550,700,550,550,600,1650,550,600,550,1800,550,1650,600,550,550,1700,550,700,550,550,600,1650,550,1700,550,700,550,550,550,600,550,1700,550,700,550,550,550,1650,600,550,550,1850,550,550,550,600,550,1650,600,700,550,550,550,550,600,550,550,1800,550,600,550,550,550,600,550,700,550,1650,550,1700,550,600,550,700,550,550,550,1700,550,550,550,700,550,600,550,550,600,550,550,700,550,550,550,1700,550,550,600,700,550,550,550,550,600,550,550,700,550,600,550,550,550,600,550,700,550,550,550,550,600,550,550,750,550,550,550,600,550,550,550,1850,550,1650,550,1700,550,600,550,1650,600,32714#", key_action_ir_air_adjust_temp_26);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3100,2950,3050,4250,600,1650,550,550,600,1650,550,700,550,600,550,1650,550,600,550,1750,600,1650,600,550,600,1650,550,1800,550,600,550,1650,600,1650,550,700,550,600,550,550,600,1650,550,700,550,550,600,1650,550,600,550,1750,600,550,550,600,550,1650,600,700,550,550,550,600,550,550,550,1800,550,600,550,550,550,600,550,700,550,1650,600,1650,550,600,550,700,550,550,550,1700,550,550,550,750,500,600,550,600,550,550,550,700,550,600,550,1650,550,600,550,700,550,550,550,600,550,550,550,750,500,600,550,550,550,600,550,700,550,550,550,600,550,550,600,700,550,550,550,600,550,1650,550,750,550,1700,550,1650,550,600,550,1650,600,41388#", key_action_ir_air_adjust_temp_27);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3100,3000,3000,4200,650,1650,550,550,600,1650,550,700,550,600,550,1650,600,550,550,1800,550,1700,550,1700,550,550,550,700,550,550,600,1650,600,1650,550,700,550,600,550,550,600,1650,550,700,550,600,550,1650,550,550,600,1800,550,550,550,600,550,1650,600,650,600,550,550,550,600,1650,550,700,600,550,550,550,550,600,550,700,550,1650,600,1650,600,550,550,700,550,550,550,1700,550,600,550,700,550,550,600,500,600,550,550,700,550,600,550,1650,550,600,550,700,550,550,550,600,550,600,550,700,550,550,550,550,550,600,550,700,550,550,550,600,550,550,600,700,550,600,550,550,550,1700,550,1800,550,1700,550,1700,550,1650,550,600,550,25644#", key_action_ir_air_adjust_temp_28);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3000,4250,600,1650,550,600,550,1650,550,700,550,600,550,1650,550,600,550,1750,600,1650,600,1650,600,550,550,1800,600,550,550,1700,550,1650,550,750,500,600,550,550,600,1650,550,700,550,600,550,1650,550,600,550,1800,550,600,550,550,550,1650,600,700,550,600,550,550,550,1650,600,650,600,550,550,600,550,550,550,700,600,1650,550,1700,550,550,550,700,550,600,550,1650,550,600,550,700,550,550,600,550,550,600,500,750,500,600,550,1700,550,550,550,700,550,600,550,550,600,550,550,700,550,550,550,600,550,550,550,700,550,600,550,550,550,600,550,700,550,600,550,1650,550,600,550,700,550,1700,550,1700,550,1650,550,600,550,29694#", key_action_ir_air_adjust_temp_29);
			m_mapCmd.put("0,AIRCON,test,12345678,0,0,150,3050,3000,3050,4200,600,1700,550,550,550,1650,600,650,600,550,550,1700,550,550,550,1800,600,1650,600,1650,550,1700,550,700,550,600,500,1700,550,1700,550,700,550,550,550,600,550,1650,600,650,600,550,550,1650,600,550,550,1800,600,550,550,600,550,1650,600,650,600,550,550,550,550,1700,550,700,550,600,550,550,550,600,500,750,550,1700,500,1700,550,600,550,650,600,550,550,1700,550,550,550,700,550,600,550,600,500,600,550,700,550,550,550,1700,550,600,550,650,600,550,550,600,550,550,550,700,550,600,550,550,550,600,550,700,550,550,550,600,500,600,550,750,550,550,550,1700,550,550,550,1850,550,1700,550,1650,550,1700,550,600,550,44688#", key_action_ir_air_adjust_temp_30);
					
			
			for (String key : m_mapCmd.keySet()) {
				String[] strValues = (String[]) m_mapCmd.get(key);
				boolean result = true;
				for (int i = 0; i < strValues.length; i++) {
					if (text.indexOf(strValues[i]) == -1) {
						result = false;
						break;
					}
				}
				if (result == true) {
					cmd_text = key;
					break;
				}
			}

			if (!cmd_text.isEmpty()) {
				if (b_speech == true && tSpeech != null) {
					String speech_text = "Ê≠£Âú®‰∏∫ÊÇ®" + text;
					tSpeech.speak(speech_text,  TextToSpeech.QUEUE_FLUSH, null);
				}
				
				new send_NetWorkData_Async(moduleID, cmd_text, mHandler).execute();
			}
		}
		

		private byte[] changeCommand(String cmd_text) {
			byte[] byte_info;
			
			String revMsg = cmd_text.substring(0, cmd_text.indexOf("#"));
			String arrays[] = revMsg.split(",");
			String cmd = arrays[1];
			int i = 0;
			int j = 0;
			
			// Á∫¢Â§ñÂëΩ‰ª§ÂçïÁã¨Â§ÑÁêÜ
			if (arrays[1].equals("AIRCON") == true) {
				byte_info = new byte[512];
				
				// ‰∏¥Êó∂DebugÔºåË¶ÅÂà†Èô§
				int count = 0;
				int length = Integer.parseInt(arrays[6]);
				for (j = 0; j < length; j++) {
					int value = Integer.parseInt(arrays[7 + j]);
					char a = (char)((value >> 8) & 0xFF);
					char b = (char)(value & 0xFF);
					count = count + a + b;
				}
				
				String strHeader = arrays[0] + "," + arrays[1] + "," + arrays[2] + "," + arrays[3] + "," + arrays[4] + "," + arrays[5] + "," +  arrays[6] + "," + count + ",";
				byte[] temp = strHeader.getBytes();
				for (i = 0; i < temp.length; i++) {
					byte_info[i] = temp[i];
				}
				
				length = Integer.parseInt(arrays[6]);
				for (j = 0; j < length; j++) {
					int value = Integer.parseInt(arrays[7 + j]);
					
					byte_info[i++] = (byte)((value >> 8) & 0xFF);
					byte_info[i++] = (byte)(value & 0xFF);
				}
				
				byte_info[i++] = '#';
				for (; i < 512; i++) {
					byte_info[i] = 0;
				}
				
				String print_str = "";
				for (i = 0; i < byte_info.length; i++) {
					int v = byte_info[i] & 0xFF;
			        String hv = Integer.toHexString(v);
			        
					print_str = print_str + hv + ",";
				}
				
				Log.v("IR_Send", "IR_Send command:" + new String(byte_info));
				Log.v("IR_Send", "IR_Send command:" + print_str);
				
			} else {
				 byte_info = cmd_text.getBytes();
				 Log.v("IR_Send", "Normal command:" + new String(byte_info));
			}
			
			return byte_info;
			
		}

		private void showTip(final Handler mHandler, final String str)
		{
			new Thread(new Runnable(){
				public void run(){
					Message msg = new Message();
					msg.what = MSG_SHOW_MESSAGE;
					msg.obj = str;
					mHandler.sendMessage(msg);
				}
			}).start();
		}

		class send_NetWorkData_Async extends AsyncTask<Void, Void, Void>  {
			private String ipAddress;
			private String moduleID;
			private String str_Text;
			private byte[] str_Text_byte = new byte[512];
			private Socket socket = null;
			private String buffer = "";
			private int timeout = 500;
			Handler mHandler = null;
			
			int msg_notify = MSG_NOTIFY_SUCCESS;

			public send_NetWorkData_Async(String moduleID, String str_Text, Handler handler) {
				this.ipAddress = PubDefine.THINGZDO_HOST_NAME;
				this.moduleID = moduleID;
				this.str_Text = str_Text;
				mHandler = handler;
			}
			
			public send_NetWorkData_Async(String ipAddress, byte[] str_Text) {
				this.ipAddress = ipAddress;
				for (int i = 0; i < str_Text.length; i++) {
					this.str_Text_byte[i] = str_Text[i];
				}			
			}

			@Override
			protected Void doInBackground(Void... params) {
				// UDP Mode
				msg_notify = sendCommandRequestWithUDPSocket(ipAddress, UDP_SRC_PORT, UDP_DEST_PORT, timeout, UDP_MAX_RETRIES_SEND, str_Text);
				return null;
			}
			
			@Override
			protected void onPostExecute(Void result) {
					mHandler.sendEmptyMessage(msg_notify);
			}

		}
		

		public static int sendCommandRequestWithUDPSocket(String ipAddress, int localPort, int remotePort, int timeout, int max_retries, String str_Text) {
			int msg_notify = 0;
			try {
				InetAddress remoteInetAddress = InetAddress.getByName(ipAddress); // ÊúçÂä°Âô®Âú∞Âù?
			    // Convert the argument String to bytes using the default encoding
			    //ÂèëÈ?ÅÁöÑ‰ø°ÊÅØ
			    byte[] bytesToSend = str_Text.getBytes();
		
			    DatagramSocket socket = new DatagramSocket(localPort);
			    socket.setSoTimeout(timeout); 									// ËÆæÁΩÆÈòªÂ°ûÊó∂Èó¥
			
			    DatagramPacket sendPacket = new DatagramPacket(bytesToSend, 	// Áõ∏ÂΩì‰∫éÂ∞ÜÂèëÈ?ÅÁöÑ‰ø°ÊÅØÊâìÂåÖ
			        bytesToSend.length, remoteInetAddress, remotePort);
			
			    int tries = 0;      											// Packets may be lost, so we have to keep trying
			    do {
			    	// Send Function
			    	try {
			    		socket.send(sendPacket);          	// ÂèëÈ?Å‰ø°ÊÅ?
			    	 } catch (InterruptedIOException e) { // ÂΩìreceive‰∏çÂà∞‰ø°ÊÅØÊàñË?ÖreceiveÊó∂Èó¥Ë∂ÖËøá3ÁßíÊó∂ÔºåÂ∞±ÂêëÊúçÂä°Âô®ÈáçÂèëËØ∑Ê±Ç
					        tries += 1;
					        Log.v("Send UDP Message", "Send Timed out, " + (max_retries - tries) + " more tries...");
					 }
					    
			    } while (tries >= max_retries);
			
			    socket.close();
					
			    if (tries < max_retries) { 	// ÂèëÈ?ÅÊàêÂä?
					msg_notify = MSG_NOTIFY_SUCCESS;
				} else {					// ÂèëÈ?ÅÂ§±Ë¥?
					msg_notify = MSG_NOTIFY_NETWORK_FAIL;
				}
			} catch (Exception e) {
				e.printStackTrace();
				msg_notify = MSG_NOTIFY_NETWORK_FAIL;
			}
			return msg_notify;
		}

		public static int sendCommandRequestWithUDPSocket(String ipAddress, int localPort, int remotePort, int timeout, int max_retries, byte[] str_Text) {
			int msg_notify = 0;
			try {
				InetAddress remoteInetAddress = InetAddress.getByName(ipAddress); // ÊúçÂä°Âô®Âú∞Âù?
			    // Convert the argument String to bytes using the default encoding
			    //ÂèëÈ?ÅÁöÑ‰ø°ÊÅØ
			    byte[] bytesToSend = str_Text;
		
			    DatagramSocket socket = new DatagramSocket(localPort);
			    socket.setSoTimeout(timeout); 									// ËÆæÁΩÆÈòªÂ°ûÊó∂Èó¥
			
			    DatagramPacket sendPacket = new DatagramPacket(bytesToSend, 	// Áõ∏ÂΩì‰∫éÂ∞ÜÂèëÈ?ÅÁöÑ‰ø°ÊÅØÊâìÂåÖ
			        bytesToSend.length, remoteInetAddress, remotePort);
			
			    int tries = 0;      											// Packets may be lost, so we have to keep trying
			    do {
			    	// Send Function
			    	try {
			    		socket.send(sendPacket);          	// ÂèëÈ?Å‰ø°ÊÅ?
			    	 } catch (InterruptedIOException e) { // ÂΩìreceive‰∏çÂà∞‰ø°ÊÅØÊàñË?ÖreceiveÊó∂Èó¥Ë∂ÖËøá3ÁßíÊó∂ÔºåÂ∞±ÂêëÊúçÂä°Âô®ÈáçÂèëËØ∑Ê±Ç
					        tries += 1;
					        Log.v("Send UDP Message", "Send Timed out, " + (max_retries - tries) + " more tries...");
					 }
					    
			    } while (tries >= max_retries);
			
			    socket.close();
					
			    if (tries < max_retries) { 	// ÂèëÈ?ÅÊàêÂä?
					msg_notify = MSG_NOTIFY_SUCCESS;
				} else {					// ÂèëÈ?ÅÂ§±Ë¥?
					msg_notify = MSG_NOTIFY_NETWORK_FAIL;
				}
			} catch (Exception e) {
				e.printStackTrace();
				msg_notify = MSG_NOTIFY_NETWORK_FAIL;
			}
			
			return msg_notify;
		}

}
