package com.sherman.smartlockex.ui.message;

import java.util.ArrayList;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.os.AsyncTask;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.view.ViewGroup;
import android.widget.ListView;

import com.sherman.smartlockex.ui.common.SmartLockFragment;
import com.sherman.smartlockex.ui.smartlockex.SmartLockApplication;
import com.sherman.smartlockex.ui.util.MyAlertDialog;
import com.sherman.smartlockex.ui.util.RefreshableView;
import com.sherman.smartlockex.ui.util.RefreshableView.PullToRefreshListener;
import com.sherman.smartlockex.R;

public class MessageFragment extends SmartLockFragment
		implements
			View.OnClickListener {
	private ListView mDevList = null;

	private String mFocusPlugId = "0";
	private boolean mFocusPlugPower = false;

//	private RefreshableView mRefreshableView = null;

	private static MessageFragment mFragment = null;

	public static MessageFragment newInstance() {
		if (null == mFragment) {
			mFragment = new MessageFragment();
		}
		return mFragment;
	}

	public static void delete() {
		if (null != mFragment) {
			mFragment = null;
		}
	}

	@Override
	public void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);

		mContext = getActivity();

//		IntentFilter filter = new IntentFilter();
//		filter.addAction(PubDefine.PLUG_POWER_ACTION);
//		filter.addAction(PubDefine.PLUG_UPDATE);
//		filter.addAction(PubDefine.PLUG_DELETE);
//		filter.addAction(PubDefine.PLUG_NOTIFY_POWER);
//		filter.addAction(PubDefine.PLUG_NOTIFY_ONLINE);
//		filter.addAction(PubDefine.PLUG_MODIFY_PLUGNAME);
//		filter.addAction(PubDefine.PLUG_NOTIFY_CURTAIN);
//		filter.addAction(PubDefine.PLUG_BACK2AP_ACTION);
//		mContext.registerReceiver(mLoadPlugReveiver, filter);

		new Handler().postDelayed(new Runnable() {
			@Override
			public void run() {
				qryPlugsFromServer();
			}
		}, 1);
	}

	private Handler mTimeoutHandler = new Handler() {
		@Override
		public void handleMessage(Message msg) {
			if (0 == msg.what) {
				timeoutHandler.removeCallbacks(timeoutProcess);
			}
		}
	};

	private void qryPlugsFromServer() {
		registerTimeoutHandler(mTimeoutHandler);
//
//		StringBuffer sb = new StringBuffer();
//		sb.append(SmartLockMessage.CMD_SP_QRYPLUG)
//				.append(StringUtils.PACKAGE_RET_SPLIT_SYMBOL)
//				.append(PubStatus.g_CurUserName);
//
//		sendMsg(true, sb.toString(), true);
	}

	@Override
	public View onCreateView(LayoutInflater inflater, ViewGroup container,
			Bundle savedInstanceState) {
		super.onCreateView(inflater, container, savedInstanceState);
		mFragmentView = inflater.inflate(R.layout.fragment_dev, container,
				false);

		mDevList = (ListView) mFragmentView.findViewById(R.id.dev_list);

		return mFragmentView;
	}

	private Handler updateHandler = new Handler() {
		public void handleMessage(Message msg) {
			setPlugsOffline();
		};
	};

	@Override
	public void onResume() {
		super.onResume();
		SmartLockApplication.resetTask();
	}

	@Override
	public void onClick(View v) {
	}

	@Override
	public void onDestroy() {
		// TODO Auto-generated method stub
		super.onDestroy();
	}

	private Handler mPressHandler = new Handler() {
		public void handleMessage(Message msg) {
			
		};
	};
}
