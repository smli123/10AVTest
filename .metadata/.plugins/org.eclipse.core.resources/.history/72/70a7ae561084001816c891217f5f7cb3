package com.thingzdo.dataprovider;

import java.util.ArrayList;

import android.content.ContentResolver;
import android.content.ContentUris;
import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.net.Uri;
import android.util.Log;

import com.thingzdo.ui.IRSceneDefine;
import com.thingzdo.ui.SceneDefine;

public class SmartPlugSceneHelper {
	private Context mContext;
	private ContentResolver mContentResolver;
	private String TAG = "SceneHelper";

	public SmartPlugSceneHelper(Context context) {
		mContext = context;
		if (mContext == null) {
			Log.e(TAG, "Context is empty");
		} else {
			mContentResolver = mContext.getContentResolver();
		}
	}

	public ArrayList<SceneDefine> getAllIRScene() {
		ArrayList<SceneDefine> timers = new ArrayList<SceneDefine>();
		if (null == mContentResolver) {
			return null;
		}
		String order = SmartPlugContentDefine.SmartPlugScene._ID + " asc";
		Cursor cur = mContentResolver.query(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, null,
				null, null, order);

		if (null != cur) {
			while (cur.moveToNext()) {
				SceneDefine timer = new SceneDefine();
				timer.mId = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.ID_COLUMN);
				timer.mSceneId = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_ID_COLUMN);
				timer.mSceneName = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_NAME_COLUMN);
				timer.mPowerEnable = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_POWER_ENABLE_COLUMN);
				timer.mPowerModuleID = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_POWER_MODULEID_COLUMN);
				timer.mPowerStatus = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_POWER_STATUS_COLUMN);

				timer.mCurtainEnable = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_CURTAIN_ENABLE_COLUMN);
				timer.mCurtainModuleID = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_CURTAIN_MODULEID_COLUMN);
				timer.mCurtainStatus = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_CURTAIN_STATUS_COLUMN);

				timer.mAirConEnable = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_AIRCON_ENABLE_COLUMN);
				timer.mAirConModuleID = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_AIRCON_MODULEID_COLUMN);
				timer.mAirConStatus = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_AIRCON_STATUS_COLUMN);
				timer.mAirConTemperature = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_AIRCON_TEMPERATURE_COLUMN);

				timer.mPCEnable = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_PC_ENABLE_COLUMN);
				timer.mPCModuleID = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_PC_MODULEID_COLUMN);
				timer.mPCMacModuleID = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_PC_MAC_MODULEID_COLUMN);
				timer.mPCMacAddress = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.SCENE_PC_MAC_ADDRESS_COLUMN);
				timer.mPCStatus = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.SCENE_PC_STATUS_COLUMN);
				timers.add(timer);
			}
			cur.close();
		}
		return timers;
	}
	public IRSceneDefine getIRScene(String plugId, int timerId) {
		IRSceneDefine timer = new IRSceneDefine();
		if (null == mContentResolver) {
			return null;
		}

		String where = SmartPlugContentDefine.SmartPlugScene.PLUG_ID + "="
				+ plugId + " AND "
				+ SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID + "='"
				+ timerId + "'";

		Cursor cur = mContentResolver.query(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, null,
				where, null, null);
		if (null != cur) {
			while (cur.moveToNext()) {
				timer.mId = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.ID_COLUMN);
				timer.mIRSceneId = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID_COLUMN);
				timer.mPlugId = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.PLUG_ID_COLUMN);
				timer.mPower = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_POWER_COLUMN);
				timer.mMode = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_MODE_COLUMN);
				timer.mDirection = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_DIRECTION_COLUMN);
				timer.mScale = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_SCALE_COLUMN);
				timer.mTemperature = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TEMPERATURE_COLUMN);
				timer.mTime = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TIME_COLUMN);
				timer.mPeriod = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.IRSCENE_PERIOD_COLUMN);
				timer.mIRName = cur
						.getString(SmartPlugContentDefine.SmartPlugScene.IRSCENE_IRNAME_COLUMN);
				timer.mEnable = cur
						.getInt(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ENABLE_COLUMN);
			}
			cur.close();
			return timer;
		} else {
			return null;
		}
	}
	// ����һ����ʱ����
	public long addIRScene(final IRSceneDefine timer) {
		if (null == mContentResolver) {
			return 0;
		}
		if (null == timer) {
			return 0;
		}

		ContentValues values = new ContentValues();
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID,
				timer.mIRSceneId);
		values.put(SmartPlugContentDefine.SmartPlugScene.PLUG_ID, timer.mPlugId);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_POWER,
				timer.mPower);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_MODE,
				timer.mMode);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_DIRECTION,
				timer.mDirection);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_SCALE,
				timer.mScale);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TEMPERATURE,
				timer.mTemperature);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TIME,
				timer.mTime);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_PERIOD,
				timer.mPeriod);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_IRNAME,
				timer.mIRName);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ENABLE,
				timer.mEnable);

		Uri uri = mContentResolver.insert(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, values);

		if (null == uri) {
			return 0;
		}
		try {
			long id = ContentUris.parseId(uri);
			return id;
		} catch (Exception e) {
			Log.e(TAG, e.getMessage());
			return 0;
		}
	}

	// ɾ��һ����ʱ����
	public boolean deleteIRScene(int timerId) {
		if (null == mContentResolver) {
			return false;
		}
		String where = SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID + "='"
				+ timerId + "'";
		int count = mContentResolver.delete(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, where,
				null);
		return count > 0 ? true : false;
	}

	// ɾ��һ�����������ж�ʱ����
	public boolean clearIRScene(String lpugId) {
		if (null == mContentResolver) {
			return false;
		}
		String where = SmartPlugContentDefine.SmartPlugScene.PLUG_ID + "='"
				+ lpugId + "'";
		int count = mContentResolver.delete(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, where,
				null);
		return count > 0 ? true : false;
	}

	// �޸�һ����ʱ����
	public int modifyIRScene(IRSceneDefine timer) {
		if (null == mContentResolver) {
			return -1;
		}
		if (null == timer) {
			return -1;
		}

		ContentValues values = new ContentValues();
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID,
				timer.mIRSceneId);
		values.put(SmartPlugContentDefine.SmartPlugScene.PLUG_ID, timer.mPlugId);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_POWER,
				timer.mPower);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_MODE,
				timer.mMode);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_DIRECTION,
				timer.mDirection);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_SCALE,
				timer.mScale);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TEMPERATURE,
				timer.mTemperature);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_TIME,
				timer.mTime);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_PERIOD,
				timer.mPeriod);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_IRNAME,
				timer.mIRName);
		values.put(SmartPlugContentDefine.SmartPlugScene.IRSCENE_ENABLE,
				timer.mEnable);

		String where = SmartPlugContentDefine.SmartPlugScene.PLUG_ID + "='"
				+ timer.mPlugId + "' AND "
				+ SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID + "='"
				+ timer.mIRSceneId + "'";
		int index = mContentResolver.update(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, values,
				where, null);
		return index;
	}

	public int getMaxSceneId(String plugid) {
		if (null == mContentResolver) {
			return 0;
		}
		int maxid = 0;
		String[] fields = {"max("
				+ SmartPlugContentDefine.SmartPlugScene.IRSCENE_ID
				+ ") as maxid"};
		String sWhere = SmartPlugContentDefine.SmartPlugScene.PLUG_ID + "='"
				+ plugid + "'";
		Cursor cur = mContentResolver.query(
				SmartPlugContentDefine.SmartPlugScene.ALL_CONTENT_URI, fields,
				sWhere, null, null);

		if (null != cur) {
			while (cur.moveToNext()) {
				maxid = cur.getInt(0);
			}
			cur.close();
		}
		maxid = (maxid < 100) ? 100 : maxid;
		return maxid + 1;
	}

}